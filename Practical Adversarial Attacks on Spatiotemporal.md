# Practical Adversarial Attacks on Spatiotemporal Traffic Forecasting Models  
## 摘要  
基于机器学习的交通预测模型利用复杂的时空自相关来提供对全市交通状态的准确预测。然而，现有的方法假设了一个可靠且公正的预测环境，这在现实中并不总是可用的。在这项工作中，我们研究了时空交通预测模型的脆弱性，并提出了一个实用的对抗性时空攻击框架。具体来说，  
1. 不是同时攻击所有地理分布的数据源，而是提出了一种迭代梯度引导节点显着性方法来识别与时间相关的受害节点集。  
2. 此外，我们设计了一种基于时空梯度下降的方案，以在扰动约束下生成实值对抗交通状态。同时，我们从理论上证明了对抗性流量预测攻击的最差性能界限。  
   
对两个真实世界数据集的广泛实验表明，所提出的两步框架在各种先进的时空预测模型上实现了高达 67.8% 的性能下降。值得注意的是，我们还表明，使用我们提出的攻击进行k对抗性训练可以显着提高时空流量预测模型的鲁棒性。

## 引言  
机器学习的时空预测模型已广泛应用于现代智能交通系统 (ITS)，以提供准确及时的交通动态预测，例如交通流量 [1]、交通速度 [2、3] 和预计到达时间 [ 4, 5]。尽管在提高预测准确性和实用性方面取得了丰硕的进展[6]，但很少有人关注时空预测模型的稳健性。如图表明在几个随机选择的节点上注入轻微的对抗性扰动可以显着降低流量整个系统的预测精度。 ![example graph](https://github.com/Liwu-di/papers-read/blob/main/pic/62.png)  
近年来，对抗性攻击在各种应用领域得到了广泛的研究，例如计算机视觉和自然语言处理[7]。然而，两个主要挑战阻止了将现有的对抗性攻击策略应用于时空流量预测。  
1. 首先，交通预测系统通过利用来自地理分布式数据源（例如，数百个道路传感器和数千个车载 GPS 设备）的信号进行预测。操纵所有数据源以同时注入对抗性扰动既昂贵又不切实际。  
2. 此外，最先进的交通预测模型通过交通网络传播本地交通状态，以进行更准确的预测[5]。攻击一些任意数据源将导致对整个系统的节点变化影响。如何识别攻击预算有限的突出受害节点子集以最大化攻击效果是第一个挑战。  
3. 其次，与大多数现有的专注于时不变标签分类的对抗性攻击策略不同 [8, 9]，针对流量预测的对抗性攻击旨在破坏目标模型以对连续流量状态进行有偏差的预测。如何在不了解未来交通状态的基本事实的情况下生成真实值的对抗性示例是另一个挑战。  
为此，在本文中，我们提出了一种实用的对抗性时空攻击框架，该框架可以破坏预测模型，从而得出有偏见的全市交通预测。具体来说，我们首先设计了一种迭代梯度引导方法来估计节点显着性，这有助于识别一小部分与时间相关的受害节点。此外，提出了一种时空梯度下降方案来指导攻击方向并在人类不可察觉的扰动约束下生成实值对抗交通状态。所提出的攻击框架与预测模型架构无关，并且可推广到各种攻击设置，即白盒攻击、灰盒攻击和黑盒攻击。同时，我们从理论上分析了对抗性流量预测攻击的最差性能保证。我们证明了时空交通预测模型的对抗鲁棒性与受害节点的数量、最大扰动界限和交通网络的最大程度有关。我们表明，攻击交通系统中 10% 的节点可以将全局预测平均误差 (MAE) 从 1.975 分解为 6.1329。此外，在扩展的白盒和黑盒攻击设置下，对抗性攻击分别会导致 68.65% 和 56.67% 的性能下降。最后，我们还表明，将我们生成的对抗性示例与对抗性训练相结合可以显着提高时空交通预测模型的鲁棒性。  

## 背景与问题陈述  
1. 交通预测  
令 Gt = (V, E) 表示时间步 t 的交通网络，其中 V 是一组 n 个节点（例如，区域、路段、道路传感器等），E 是一组边。 Gt 的构建可以分为两种类型，（1）基于先验，基于地理接近度和相似性等指标预先定义 Gt [10]，以及（2）基于学习，自动学习 Gt端到端方式[2]。请注意，Gt 可以是静态的或随时间变化的，具体取决于预测模型。我们将 Xt = (x1,t, x2,t, ···, xn,t) 表示为与 Gt 相关的时空特征，其中 xi,t ∈ R c 表示 c 维时变交通状况（例如，交通量、交通速度）和节点 vi ∈ V 在 t 处的上下文特征（例如，天气、周围 POI）。时空交通预测问题旨在预测所有 vi ∈ V 在接下来的 τ 个时间步长上的交通状态， ![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/63.png)   
![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/64.png)  表示交通状态包含前T个时间步的输入特征和交通网络，fθ(·)是由θ参数化的时空交通预测模型，并且![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/65.png)  是从时间步长 t+1 到 t+τ 估计的 V 感兴趣的交通状况。我们表示![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/84.png)作为 ![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/66.png) 的基本事实。  

2. 对抗攻击  
给定机器学习模型，对抗性攻击旨在通过生成最佳对抗性示例来误导模型得出有偏见的预测![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/67.png)  其中 x 0 是在 Lp 范数下具有最大界限 ε 的对抗性示例，以保证扰动对人类来说是不可察觉的，y 是干净示例 x 的基本事实。  
已经提出了各种基于梯度的方法来生成对抗样本，例如 FGSM [14]、PGD [8]、MIM [9] 等。例如，对抗样本 x 0 = x + εsign(∇xLCE(x, y; θ)) 在 FGSM 中，其中 sign(·) 是 Signum 函数，LCE(·) 是交叉熵损失。  
请注意，对抗性攻击发生在测试阶段，攻击者无法操纵预测模型或其输出。在良性测试集上，预测模型可以表现良好。根据攻击者在测试阶段可以访问的信息量，对抗性攻击可以分为三类。白盒攻击。攻击者可以完全访问目标模型，包括模型架构、模型参数、梯度、模型输出、输入流量状态以及相应的标签。灰盒攻击。攻击者可以部分访问系统，包括目标模型和输入流量状态，但没有标签。黑盒攻击。攻击者只能访问输入流量状态、查询目标模型的输出或利用代理模型来制作对抗样本。  
3. 针对时空流量预测的对抗性攻击
这项工作旨在将对抗性攻击应用于时空交通预测模型。我们首先将对抗性交通状态定义如下，  
![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/68.png)  
其中 St ∈ {0, 1} n×n 是一个对角矩阵，第 i 个对角元素表示节点 i 是否是受害者节点，X0 t 是被称为对抗性时空特征的扰动时空特征。我们通过受害节点预算 η （受害者节点个数）和扰动预算 ε 来限制对抗性交通状态。请注意，根据对抗性攻击的定义，我们将 Gt 的拓扑结构保持不变，因为我们将邻接关系视为模型参数的一部分，可以以端到端的方式自动学习。  
攻击目标。攻击者旨在制造对抗性交通状态来欺骗时空预测模型，从而得出有偏见的预测。形式上，给定一个时空预测模型 fθ(·)，针对时空交通预测的对抗性攻击定义为  
![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/69.png)   
其中 Ttest 和 Ttrain 分别表示所有测试和训练样本的时间步长集。 L(·) 是测量预测交通状态和地面实况之间距离的损失函数，θ ∗ 是在训练阶段学习的最佳参数。由于在时空交通预测设置下的真相（即未来的交通状态）在运行时不可用，因此实际的对抗性时空攻击主要落入灰色盒子攻击环境中。然而，研究白盒攻击仍然有助于帮助我们了解对抗性攻击的工作原理，并有助于提高时空流量预测模型的鲁棒性（例如，应用对抗性训练）。我们将在 3.2 节讨论如何将我们提出的对抗性攻击框架扩展到白盒和黑盒设置。  

## 方法  
在本节中，我们将详细介绍实际的对抗性时空攻击框架。具体来说，我们的框架包括两个步骤：（1）识别时间相关的受害节点，以及（2）使用对抗性流量状态进行攻击。  
1. 识别时间相关的受害节点  
   将攻击性时空预测与传统分类任务区分开来的一个独特特征是在测试阶段无法访问基本事实。因此，我们首先构建未来交通状态的代理标签来指导攻击方向，![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/70.png) 其中 gφ(·) 是一个广义函数（例如，tanh(·)、sin (·)、fθ(·)），δt+1:t+τ 是从概率分布 π(δt+1:t +τ ) 增加攻击方向的多样性。在我们的实现中，我们得出![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/71.png)  基于预训练的预测模型参数 θ ∗ 和 δt+1:t+τ ∼ U(-ε/10, ε/10)。在现实世界的生产中[5]，预测模型通常以在线方式更新（例如，每小时）。因此，我们根据之前的输入数据估计缺失的最新交通状态，![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/72.png)  其中 gφ(·) 是由 φ 参数化的估计函数。为简单起见，我们直接从预训练的交通预测模型 fθ ∗ (·) 中获得 φ。使用代理交通状态标签![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/73.png) ，我们推导出每个节点的时间相关节点显着性 (TDNS) 为![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/74.png) where ![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/75.png) 是损失函数，σ是激活函数。直观地说，Mt 揭示了具有相同扰动程度的节点损失影响。请注意，根据时间步长 t，Mt 可能会有所不同。类似的想法也被用于识别图像分类的静态像素显着性[15]。更详细地说，公式 6 中的损失函数![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/75.png) 通过基于迭代梯度的对抗方法 [8] 进行更新， ![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/76.png)  
   where ![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/77.png) 是第 i 次迭代的对抗性交通状态，α 是步长，并且是第 i 次迭代的对抗性交通状态，α 是步长，并且where ![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/78.png) 是用最大扰动界限 ε 裁剪时空特征的映射操作。注意![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/79.png) 对于每批数据![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/80.png) 与时间相关的节点显着性梯度由下式推导![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/81.png) 其中 γ 是批量大小。我们使用 RELU 激活函数来计算每个时间步的非负显着性分数，![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/82.png) 最后，我们根据 Mt 得到受害节点 St 的集合，![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/83.png)其中 s(i,i),t 表示 St 的第 i 个对角线元素，Top(·) 是一个 0-1 指示函数，如果 vi 是时间步 t 的前 k 个显着节点，则返回。
2. 具有对抗性流量状态的攻击  
   基于时间相关的受害者集，我们对时空流量预测模型进行对抗性攻击。具体来说，我们首先基于梯度下降方法生成扰动对抗性交通特征。以广泛使用的投影梯度下降（PGD）[8]为例，我们构建时空投影梯度下降（STPGD）如下
   ![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/85.png)  
   where ![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/86.png) 是迭代梯度下降中第 i - 1 次迭代的对抗性交通状态，α 是步长，并且![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/87.png) 是将对抗性特征绑定到 ε 球中的操作。注意![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/88.png) 我们不像普通 PGD 那样扰动所有节点，而是只在 St 中选定的受害节点上注入扰动。类似地，我们可以通过扩展其他基于梯度的方法（如 MIM [9]）来生成扰动的对抗性流量特征。在测试阶段，我们可以注入对抗性流量状态![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/89.png) 应用对抗性攻击，其中![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/90.png) 并且![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/91.png) （注意这个属于的符号，因为公式说的是一个向量，但是应用的时候是向量组）  
    灰盒设置下的对抗性时空攻击框架的细节在算法 1 中。整体对抗性时空攻击可以很容易地扩展到白盒和黑盒设置，下面将详细介绍。白盒攻击。由于攻击者可以在白盒设置下完全访问数据和标签，我们直接使用真实的地面真实交通状态来指导对抗性交通状态的生成。详细算法在附录 A.1 中介绍。黑盒攻击。最严格的黑盒设置假定目标模型和标签的可访问性有限。因此，我们首先采用代理模型，该模型可以从训练数据中学习或通过查询交通预测服务 [16, 17]。然后我们基于代理模型生成对抗性流量状态来攻击目标流量预测模型。详情请参阅附录 A.2。我们以所提出的对抗性攻击策略的理论上限分析结束本节。特别是，我们展示了针对时空交通预测模型的攻击性能与所选受害节点的数量、对抗性扰动的预算以及交通网络拓扑有关。  
    ![Theorem graph](https://github.com/Liwu-di/papers-read/blob/main/pic/92.png)  

   ![Algorithm graph](https://github.com/Liwu-di/papers-read/blob/main/pic/93.png)

## 实验
1. Experimental setup
   数据集。我们使用两个流行的现实世界数据集来证明所提出的对抗性攻击框架的有效性。 (1) PEMS-BAY [18] 交通数据集源自加州交通局 (CalTrans) 绩效测量系统 (PeMS)，范围从 2017 年 1 月 1 日到 2017 年 5 月 31 日。湾区的 325 个交通传感器每收集一次交通数据5分钟。 (2) METR-LA [19] 是从 207 个洛杉矶县道路传感器收集的交通速度数据集。交通速度每 5 分钟记录一次，范围从 2012 年 3 月 1 日到 2012 年 6 月 30 日。为了评估，所有数据集按时间顺序排列，我们将前 70% 用于训练，随后 10% 用于验证，其余 20 ％ 用于检测。附录 C.   
   基线 报告了两个数据集的统计数据。在目前的文献中，很少有研究可以直接应用于实值流量预测攻击设置。为了保证比较的公平性，我们构建了如下两步基线。对于受害节点识别，我们采用随机选择并使用基于拓扑的方法（即节点度和中介中心性[20]）来选择受害节点。我们还使用 PageRank (PR) [21] 作为基线来决定受害节点的集合。对于对抗性交通状态生成，我们采用两种广泛使用的基于迭代梯度的方法 PGD [8] 和 MIM [9] 来生成对抗性扰动。总之，我们构建了八个两步基线，PGDRandom、PGD-PR、PGD-Centrality、PGD-Degree、MIM-Random、MIM-PR、MIM-Centrality 和 MIM-Degree。例如，PGD-PR 表示首先使用 PageRank 识别受害节点，然后 然后使用 PGD 应用对抗性噪声。根据对抗性扰动方法，我们比较了我们提出的框架的两个变体，即 STPGD-TDNS 和 STMIM-TDNS。  
   目标模型。为了评估所提出的对抗性攻击框架的泛化能力，我们采用最先进的时空流量预测模型 GraphWaveNet (Gwnet) [2] 作为目标模型。附录 F.   
   评估指标 中报告了更多目标模型的评估结果。我们的评估侧重于对抗性攻击对时空模型的全局和局部影响  
   ![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/94.png)  
   其中 L(·) 是用户定义的损失函数。与作为分类模型（例如，对抗性准确性）的对抗性攻击的大多数目标不同，流量预测被定义为回归任务。因此，我们采用平均平均误差（MAE）[22]和均方根误差（RMSE）[23]进行评估。更具体地说，我们定义了全局 MAE (G-MAE)、局部 MAE (L-MAE)、全局 RMSE (G-RMSE)、局部 RMSE (L-RMSE) 来评估对抗性攻击对流量预测的影响。有关四个指标的详细定义，请参阅附录 D。实施细节。所有实验均使用 PyTorch 实现，并在具有 4 个 RTX 3090 GPU 的 Linux 服务器上执行。流量速度标准化为 [0, 1]。输入长度 T 和输出长度 τ 设置为 12。我们从整个节点中选择 10% 的节点作为受害节点，ε 设置为 0.5。批量大小 γ 设置为 64。迭代 K 设置为 5，步长 α 设置为 0.1。

2. 表 1 报告了我们提出的方法针对原始预测模型和关于四个指标的八个基线的整体攻击性能。注意较大的值表示更好的攻击性能和更差的预测准确性。具体来说，我们可以进行以下观察。
   1. 首先，对抗性攻击会显着降低流量预测性能。例如，与 PeMS-BAY 和 METR-LA 数据集的原始预测结果相比，我们的方法分别实现了 (67.79%, 62.31%) 和 (19.88%, 14.55%) 的全局性能下降。 
   2. 其次，我们的方法针对所有基线实现了最佳攻击性能。特别是，STPGD-TDNS 在 PeMS-BAY 数据集上实现了 (15.80%, 15.39%) 的全局性能提升和 (23.35%, 17.19%) 的局部性能提升。同样，STMIM-TDNS 在 METR-LA 数据集上实现了 (2.44%, 2.00%) 的全局性能提升和 (11.20%, 2.70%) 的局部性能提升。
   3. 此外，我们观察到我们框架的两个变体 STPGD-TDNS 和 STMIM-TDNS 分别在 PeMS-BAY 和 METR-LA 数据集上实现了最佳攻击性能，这进一步验证了我们的框架在灵活集成不同对抗性扰动方法方面的优越性。总体而言，我们的对抗性攻击框架成功地破坏了流量预测模型以做出有偏见的预测。
   4. ![report graph](https://github.com/Liwu-di/papers-read/blob/main/pic/95.png)  
3. Ablation study
   然后我们对我们的对抗性攻击框架进行消融研究。由于页数限制，我们在 PeMS-BAY 数据集上报告 STPGD-TDNS 的结果。我们考虑了我们方法的两种变体：(1) 无随机选择受害节点进行攻击的 TDNS，以及 (2) 无 STPGD，将普通 PGD 噪声应用于选定的受害节点。如表 2 所示，通过移除我们提出的 TDNS 和 STPGD 模块，我们观察到（3.91%、6.28%、2.97%、3.60%）和（33.41%、52.45%、26.19%、32.97%）四个指标的攻击性能下降，分别。上述结果证明了两步框架的有效性。此外，我们观察到 STPGD 模块在对抗性时空攻击中起着更重要的作用。  
   ![report graph](https://github.com/Liwu-di/papers-read/blob/main/pic/96.png)  
4. Parameter sensitivity
   我们进一步研究了所提出框架的参数敏感性，包括受害节点的数量 η、扰动预算 ε 和批量大小 γ。由于页数限制，我们在 PeMS-BAY 数据集上报告 G-RMSE 的结果。我们通过使用其他指标和 METR-LA 数据集观察到类似的结果。每次我们改变一个参数时，我们都会将其他参数设置为其默认值。 η的影响。
      1. 首先，我们将受害节点的数量从 0% 变为 40%。如图 2 (a) 所示，我们的方法在受害节点预算有限的情况下实现了最佳攻击性能，并且当攻击可以应用于更多节点时优势会降低。 
      2. ε 的影响。其次，我们将扰动预算从 0% 变为 90%。如图 2（b）所示，G-RMSE 先增大后略有减小。这可能是因为公式 11 中的剪辑函数削弱了攻击噪声的多样性。 
      3. γ的影响。最后，我们将批量大小从 8 更改为 128，如图 2 (c) 所示。我们观察到对抗性攻击对批量大小相对稳定。但是，太大的批量会降低攻击性能，这可能会导致公式 8 过于平滑。
      4. ![report graph](https://github.com/Liwu-di/papers-read/blob/main/pic/97.png)  
5. 不同攻击设置下的扩展分析
   表 3 报告了我们提出的方法在白盒和黑盒攻击设置下针对原始预测模型和四个基于 PGD 的基线的整体攻击性能。对于白盒攻击，由于攻击者可以完全访问数据和模型，我们重新训练预测模型而不需要估计最新的流量状态。对于黑盒攻击，我们采用 STAWNET [12] 作为代理模型。实验结果总结在表 3 中。首先，我们观察到对抗性攻击显着降低了白盒和黑盒设置下的流量预测模型的性能。例如，与白盒和黑盒攻击下的普通预测模型相比，我们的方法实现了 ((68.65%, 66.12%) 和 (56.67%, 50.78%) 全局性能下降。此外，我们的方法始终实现最佳攻击相对于基线的性能。更具体地说，我们的方法分别在白盒设置和黑盒设置下产生（4.61%，9.13%）和（1.70%，3.28%）的全局性能提升。此外，我们观察到与灰盒设置相比，白盒设置下的攻击效率更高，黑盒设置下的攻击效率更低。这是有道理的，因为白盒设置可以完全访问数据和标签，而黑盒具有更严格的数据可访问性，并依赖代理模型来应用对抗性时空攻击。分别在白盒设置和黑盒设置下产生（4.61%，9.13%）和（1.70%，3.28%）的全局性能提升。此外，我们观察到与灰盒设置相比，白盒设置下的攻击效率更高，黑盒设置下的攻击效率更低。这是有道理的，因为白盒设置可以完全访问数据和标签，而黑盒具有更严格的数据可访问性，并依赖代理模型来应用对抗性时空攻击。  
   ![report graph](https://github.com/Liwu-di/papers-read/blob/main/pic/98.png)
6. 防御对抗性时空攻击
   最后，我们研究了对抗性时空攻击的防御。我们研究的一个主要目标是帮助提高时空预测模型的稳健性。因此，我们建议将交通预测模型的对抗性训练方案与我们的对抗性交通状态相结合，用 AT-TNDS 表示。我们将其与 (1) 传统对抗训练 (AT) [8] 和 (2) Mixup [24] 与我们的对抗交通状态进行比较。请注意，我们还尝试了其他策略，例如添加 L2 正则化等，但无法防御对抗性时空攻击。其他最先进的对抗训练方法，例如 TRADE [25]，不能直接应用于回归任务。有关更多培训详情，请参阅附录 E。表 4 报告了 PeMS-BAY 上 G-MAE 的结果。总体而言，我们观察到 AT 或 Mixup 可以成功抵抗对抗性时空攻击，将对抗性训练方案与我们的对抗性交通状态相结合的 AT-TDNS 取得了最佳效果防守表现。上述结果表明对抗性时空攻击的可防御性，应进一步研究以在未来提供更可靠的时空预测服务。  
   ![report graph](https://github.com/Liwu-di/papers-read/blob/main/pic/99.png)  

## 相关工作
见原文
## 结论
本文展示了时空交通预测模型在对抗性攻击下的脆弱性。我们提出了一个实用的对抗性时空攻击框架，它与预测模型架构无关，并且可推广到各种攻击设置。具体来说，我们首先构建了一种迭代梯度引导节点显着性方法来识别一小部分时间相关的受害节点。然后，我们提出了一种基于时空梯度下降的方案，通过灵活利用各种对抗性扰动方法来生成实值对抗性交通状态。理论分析证明了在人类不可察觉的受害者节点选择预算和扰动预算约束下所提出的两步框架的上限。最后，在现实世界数据集上的大量实验结果验证了所提出框架的有效性。报告的结果将激发对时空预测模型脆弱性的进一步研究，以及可部署在现实世界 ITS 系统中的抵御对抗性攻击的实用防御策略。






