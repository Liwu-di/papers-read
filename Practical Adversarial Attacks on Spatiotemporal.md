# Practical Adversarial Attacks on Spatiotemporal Traffic Forecasting Models  
## 摘要  
基于机器学习的交通预测模型利用复杂的时空自相关来提供对全市交通状态的准确预测。然而，现有的方法假设了一个可靠且公正的预测环境，这在现实中并不总是可用的。在这项工作中，我们研究了时空交通预测模型的脆弱性，并提出了一个实用的对抗性时空攻击框架。具体来说，  
1. 不是同时攻击所有地理分布的数据源，而是提出了一种迭代梯度引导节点显着性方法来识别与时间相关的受害节点集。  
2. 此外，我们设计了一种基于时空梯度下降的方案，以在扰动约束下生成实值对抗交通状态。同时，我们从理论上证明了对抗性流量预测攻击的最差性能界限。  
   
对两个真实世界数据集的广泛实验表明，所提出的两步框架在各种先进的时空预测模型上实现了高达 67.8% 的性能下降。值得注意的是，我们还表明，使用我们提出的攻击进行k对抗性训练可以显着提高时空流量预测模型的鲁棒性。

## 引言  
机器学习的时空预测模型已广泛应用于现代智能交通系统 (ITS)，以提供准确及时的交通动态预测，例如交通流量 [1]、交通速度 [2、3] 和预计到达时间 [ 4, 5]。尽管在提高预测准确性和实用性方面取得了丰硕的进展[6]，但很少有人关注时空预测模型的稳健性。如图表明在几个随机选择的节点上注入轻微的对抗性扰动可以显着降低流量整个系统的预测精度。 ![example graph](https://github.com/Liwu-di/papers-read/blob/main/pic/62.png)  
近年来，对抗性攻击在各种应用领域得到了广泛的研究，例如计算机视觉和自然语言处理[7]。然而，两个主要挑战阻止了将现有的对抗性攻击策略应用于时空流量预测。  
1. 首先，交通预测系统通过利用来自地理分布式数据源（例如，数百个道路传感器和数千个车载 GPS 设备）的信号进行预测。操纵所有数据源以同时注入对抗性扰动既昂贵又不切实际。  
2. 此外，最先进的交通预测模型通过交通网络传播本地交通状态，以进行更准确的预测[5]。攻击一些任意数据源将导致对整个系统的节点变化影响。如何识别攻击预算有限的突出受害节点子集以最大化攻击效果是第一个挑战。  
3. 其次，与大多数现有的专注于时不变标签分类的对抗性攻击策略不同 [8, 9]，针对流量预测的对抗性攻击旨在破坏目标模型以对连续流量状态进行有偏差的预测。如何在不了解未来交通状态的基本事实的情况下生成真实值的对抗性示例是另一个挑战。  
为此，在本文中，我们提出了一种实用的对抗性时空攻击框架，该框架可以破坏预测模型，从而得出有偏见的全市交通预测。具体来说，我们首先设计了一种迭代梯度引导方法来估计节点显着性，这有助于识别一小部分与时间相关的受害节点。此外，提出了一种时空梯度下降方案来指导攻击方向并在人类不可察觉的扰动约束下生成实值对抗交通状态。所提出的攻击框架与预测模型架构无关，并且可推广到各种攻击设置，即白盒攻击、灰盒攻击和黑盒攻击。同时，我们从理论上分析了对抗性流量预测攻击的最差性能保证。我们证明了时空交通预测模型的对抗鲁棒性与受害节点的数量、最大扰动界限和交通网络的最大程度有关。我们表明，攻击交通系统中 10% 的节点可以将全局预测平均误差 (MAE) 从 1.975 分解为 6.1329。此外，在扩展的白盒和黑盒攻击设置下，对抗性攻击分别会导致 68.65% 和 56.67% 的性能下降。最后，我们还表明，将我们生成的对抗性示例与对抗性训练相结合可以显着提高时空交通预测模型的鲁棒性。  

## 背景与问题陈述  
1. 交通预测  
令 Gt = (V, E) 表示时间步 t 的交通网络，其中 V 是一组 n 个节点（例如，区域、路段、道路传感器等），E 是一组边。 Gt 的构建可以分为两种类型，（1）基于先验，基于地理接近度和相似性等指标预先定义 Gt [10]，以及（2）基于学习，自动学习 Gt端到端方式[2]。请注意，Gt 可以是静态的或随时间变化的，具体取决于预测模型。我们将 Xt = (x1,t, x2,t, ···, xn,t) 表示为与 Gt 相关的时空特征，其中 xi,t ∈ R c 表示 c 维时变交通状况（例如，交通量、交通速度）和节点 vi ∈ V 在 t 处的上下文特征（例如，天气、周围 POI）。时空交通预测问题旨在预测所有 vi ∈ V 在接下来的 τ 个时间步长上的交通状态， ![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/63.png)   
![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/64.png)  表示交通状态包含前T个时间步的输入特征和交通网络，fθ(·)是由θ参数化的时空交通预测模型，并且![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/65.png)  是从时间步长 t+1 到 t+τ 估计的 V 感兴趣的交通状况。我们表示![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/65.png)作为 ![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/66.png) 的基本事实。  

2. 对抗攻击  
给定机器学习模型，对抗性攻击旨在通过生成最佳对抗性示例来误导模型得出有偏见的预测![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/67.png)  其中 x 0 是在 Lp 范数下具有最大界限 ε 的对抗性示例，以保证扰动对人类来说是不可察觉的，y 是干净示例 x 的基本事实。  
已经提出了各种基于梯度的方法来生成对抗样本，例如 FGSM [14]、PGD [8]、MIM [9] 等。例如，对抗样本 x 0 = x + εsign(∇xLCE(x, y; θ)) 在 FGSM 中，其中 sign(·) 是 Signum 函数，LCE(·) 是交叉熵损失。  
请注意，对抗性攻击发生在测试阶段，攻击者无法操纵预测模型或其输出。在良性测试集上，预测模型可以表现良好。根据攻击者在测试阶段可以访问的信息量，对抗性攻击可以分为三类。白盒攻击。攻击者可以完全访问目标模型，包括模型架构、模型参数、梯度、模型输出、输入流量状态以及相应的标签。灰盒攻击。攻击者可以部分访问系统，包括目标模型和输入流量状态，但没有标签。黑盒攻击。攻击者只能访问输入流量状态、查询目标模型的输出或利用代理模型来制作对抗样本。  
3. 针对时空流量预测的对抗性攻击
这项工作旨在将对抗性攻击应用于时空交通预测模型。我们首先将对抗性交通状态定义如下，  
![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/68.png)  
其中 St ∈ {0, 1} n×n 是一个对角矩阵，第 i 个对角元素表示节点 i 是否是受害者节点，X0 t 是被称为对抗性时空特征的扰动时空特征。我们通过受害节点预算 η 和扰动预算 ε 来限制对抗性交通状态。请注意，根据对抗性攻击的定义，我们将 Gt 的拓扑结构保持不变，因为我们将邻接关系视为模型参数的一部分，可以以端到端的方式自动学习。  
攻击目标。攻击者旨在制造对抗性交通状态来欺骗时空预测模型，从而得出有偏见的预测。形式上，给定一个时空预测模型 fθ(·)，针对时空交通预测的对抗性攻击定义为  
![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/69.png)   
其中 Ttest 和 Ttrain 分别表示所有测试和训练样本的时间步长集。 L(·) 是测量预测交通状态和地面实况之间距离的损失函数，θ ∗ 是在训练阶段学习的最佳参数。由于在时空交通预测设置下的真相（即未来的交通状态）在运行时不可用，因此实际的对抗性时空攻击主要落入灰色盒子攻击环境中。然而，研究白盒攻击仍然有助于帮助我们了解对抗性攻击的工作原理，并有助于提高时空流量预测模型的鲁棒性（例如，应用对抗性训练）。我们将在 3.2 节讨论如何将我们提出的对抗性攻击框架扩展到白盒和黑盒设置。  

## 方法  
在本节中，我们将详细介绍实际的对抗性时空攻击框架。具体来说，我们的框架包括两个步骤：（1）识别时间相关的受害节点，以及（2）使用对抗性流量状态进行攻击。  
1. 识别时间相关的受害节点  
   将攻击性时空预测与传统分类任务区分开来的一个独特特征是在测试阶段无法访问基本事实。因此，我们首先构建未来交通状态的代理标签来指导攻击方向，![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/70.png) 其中 gφ(·) 是一个广义函数（例如，tanh(·)、sin (·)、fθ(·)），δt+1:t+τ 是从概率分布 π(δt+1:t +τ ) 增加攻击方向的多样性。在我们的实现中，我们得出![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/71.png)  基于预训练的预测模型参数 θ ∗ 和 δt+1:t+τ ∼ U(-ε/10, ε/10)。在现实世界的生产中[5]，预测模型通常以在线方式更新（例如，每小时）。因此，我们根据之前的输入数据估计缺失的最新交通状态，![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/72.png)  其中 gφ(·) 是由 φ 参数化的估计函数。为简单起见，我们直接从预训练的交通预测模型 fθ ∗ (·) 中获得 φ。使用代理交通状态标签![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/73.png) ，我们推导出每个节点的时间相关节点显着性 (TDNS) 为![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/74.png) where ![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/75.png) 是损失函数，σ是激活函数。直观地说，Mt 揭示了具有相同扰动程度的节点损失影响。请注意，根据时间步长 t，Mt 可能会有所不同。类似的想法也被用于识别图像分类的静态像素显着性[15]。更详细地说，公式 6 中的损失函数![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/75.png) 通过基于迭代梯度的对抗方法 [8] 进行更新， ![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/76.png)  
   where ![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/77.png) 是第 i 次迭代的对抗性交通状态，α 是步长，并且是第 i 次迭代的对抗性交通状态，α 是步长，并且where ![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/78.png) 是用最大扰动界限 ε 裁剪时空特征的映射操作。注意![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/79.png) 对于每批数据![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/80.png) 与时间相关的节点显着性梯度由下式推导![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/81.png) 其中 γ 是批量大小。我们使用 RELU 激活函数来计算每个时间步的非负显着性分数，![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/82.png) 最后，我们根据 Mt 得到受害节点 St 的集合，![formula graph](https://github.com/Liwu-di/papers-read/blob/main/pic/83.png)其中 s(i,i),t 表示 St 的第 i 个对角线元素，Top(·) 是一个 0-1 指示函数，如果 vi 是时间步 t 的前 k 个显着节点，则返回。
2. 具有对抗性流量状态的攻击  
   



